@rendermode RenderMode.InteractiveWebAssembly
@using System.Text.RegularExpressions
@using System.ComponentModel.DataAnnotations
@using FrontMenuWeb.Services
@using System.Globalization

<MudDialog tabindex="0" @onkeydown=@(async (e) => {await OnKeyDown(e);})>
    <DialogContent>
        <MudFocusTrap DefaultFocus="DefaultFocus.FirstChild">
            <MudNumericField T="float"
                             @ref="_numericField"
                             Variant="Variant.Outlined"
                             Format="N3"
                             Culture="_pt"
                             HideSpinButtons="true"
                             @bind-Value="Valor" />
        </MudFocusTrap>
    </DialogContent>

    <DialogActions>
        <MudButton OnClick="Cancelar" Color="Color.Secondary">
            Cancelar
        </MudButton>
        <MudButton @ref=_buttonConfirmar OnClick="Confirmar" Color="Color.Primary">
            OK
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; }
    [Parameter]
    public string ContentText { get; set; }

    public CultureInfo _pt = CultureInfo.GetCultureInfo("pt-BR");
    private MudNumericField<float> _numericField { get; set; } = new MudNumericField<float>();
    private MudButton _buttonConfirmar { get; set; } = new MudButton();

    [Parameter]
    public string ButtonText { get; set; }

    [Parameter]
    public Color Color { get; set; }

    [Parameter]public float Valor { get; set; } = 1f;

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            _numericField.FocusAsync();
            _numericField.SelectAsync();
        }
    }

    public async Task Confirmar()
    {
        await _buttonConfirmar.FocusAsync();

        if (Valor < 0)
        {
            Snackbar.Add("o valor deve ser maior que 0", Severity.Error);
            return;
        }

        MudDialog.Close(DialogResult.Ok(Valor));
    }

    void Cancelar() => MudDialog.Cancel();

    private async Task OnKeyDown(KeyboardEventArgs e)
    {
        switch (e.Key)
        {
            case "Enter":
                await Confirmar();
                break;

        }
    }
}
